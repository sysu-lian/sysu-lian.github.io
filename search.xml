<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[太极拳]]></title>
      <url>https://lian1925.github.io/2016/09/01/taiji/</url>
      <content type="html"><![CDATA[<h2 id="太极拳论-王宗岳"><a href="#太极拳论-王宗岳" class="headerlink" title="太极拳论 王宗岳"></a>太极拳论 王宗岳</h2><p>太极者，无极而生，动静之机，阴阳之母也。<br><a id="more"></a><br> 动之则分，静之则合。无过不及，随曲就伸。人刚我柔谓之走，我顺人背谓之粘。动急则急应，动缓则缓随。虽变化万端，而理唯一贯。由招熟而渐悟懂劲，由懂劲而阶及神明。然非用力之久，不能豁然贯通焉。 虚领顶劲，气沉丹田。不偏不倚，忽隐忽现。左重则左虚，右重则右杳。仰之则弥高，俯之则弥深，进之则愈长，退之则愈促。一羽不能加，蝇虫不能落，人不知我，我独知人。英雄所向无敌，盖皆由此而及也。<br>斯技旁门甚多，虽势有区别，概不外乎壮欺弱，慢让快耳。有力打无力，手慢让手快，皆是先天自然之能，非关学力而有为也。察四两拨千斤之句，显非力胜；观耄耋能御众之形，快何能为。立如平/秤准，活似车轮。偏沉则随，双重则滞。每见数年纯功，不能运化者，率皆自为人制，双重之病未悟耳。欲避此病，须知阴阳。粘即是走，走即是粘。阴不离阳，阳不离阴。阴阳相济，方为懂劲。懂劲后，愈练愈精，默识揣摩，渐至从心所欲。本是舍己从人，多误舍近求远。所谓差之毫厘，谬之千里，学者不可不详辨焉。</p>
<h2 id="太极拳论-张三丰"><a href="#太极拳论-张三丰" class="headerlink" title="太极拳论 张三丰"></a>太极拳论 张三丰</h2><p>一举动，周身俱要轻灵，尤须贯串。气宜鼓荡，神宜内敛，无使有缺陷处，无使有凹凸处，无使有断续处。其根在脚，发于腿，主宰于腰，行于手指，由脚而腿而腰，总须完整一气，向前退后，乃能得机得势。有不得机得势处，身便散乱，其病必于腰腿求之，上下前后左右皆然。凡此皆是意，不在外面，有上即有下，有前则有后，有左则有右。如意要向上，即寓下意，若将物掀起而加以挫之之力。斯其根自断，乃坏之速而无疑。虚实宜分清楚，一处有一处虚实，处处总此一虚实，周身节节贯串，无令丝毫间断耳。<br>长拳者，如长江大海，滔滔不绝也。掤、捋、挤、按、采、挒、肘、靠，此八卦也。进步、退步、左顾、右盼、中定，此五行也。掤、捋、挤、按，即（先天八卦）乾、坤、坎、离、四正方也；采、挒、肘、靠，即巽、震、兑、艮、四斜角也。进、退、盼、顾、定，即金木水火土也，合之则为十三势也。</p>
<h2 id="五字要言-杨班候"><a href="#五字要言-杨班候" class="headerlink" title="五字要言 杨班候"></a>五字要言 杨班候</h2><p>拳理极精细，勿以当儿戏，欲学拳术者，先将基础立，<br>拳中基本功，有长既是师，研究其性理，技击是其次，<br>万莫学死方，动作要有理，不学招法手，与死方无异，<br>比如当大夫，尽学成方剂，药方开出来，等候病来治，<br>得病合我方，未闻有此理，就是有点效，也是瞎碰到，<br>结果背原理，伤病不为奇，莫学拍打功，以免本能失，<br>皮肉徒受苦，气血多凝滞，有害于卫生，又有碍拳意，<br>力紧神便死，岂能把人治，怀疑不凭信，请自体察试，<br>要知拳中理，首先站桩起，意在宇宙间，天地人一体，<br>运动如抽丝，开弓既试力，四肢弓崩撑，运动软慢松，<br>曲伸与开合，身由云端起，呼吸细静长，舒畅皆如意，<br>形象似颠狂，如醉如呆痴，蛇行趟泥步，揉球摩擦力，<br>两手似兜泥，如捞稠糖稀，内外要松静，敛神听微雨，<br>绵绵觉如醉，悠悠水中戏，默对向天空，虚灵须定意，<br>洪炉大冶金，陶熔物不计，神机由内变，调息呼吸气，<br>守静如处女，动似迅雷至，力松意宜紧，本是涵养炁，<br>螺旋滚无形，毛发力如戟，筋骨遒既放，浑噩一惊时，<br>支点增强力，遍体弹簧似，百骸若机轮，旋转有劲力，<br>腰身似蛇惊，步行旋风起，纵横起巨波，如鲸回旋式，<br>顶心力空灵，浑身如线提，两目神光敛，鼻息耳凝闭，<br>小腹要常圆，胸肋微含蓄，指端力如电，骨节锋棱起，<br>活泼比猿捷，迈步如猫似，大凡举与动，浑身皆消息，<br>一触既爆发，威力无边际，学者莫好奇，要用自然力，<br>良知与良能，实践学来的，动静任自然，万勿用浊力，<br>反婴寻天真，躯柔如童浴，勿忘勿助长，升堂渐入室，<br>论技说应敌，不费吹灰力，拳术之动作，手足板眼齐，<br>首要力均整，内外要合一，曲伸随意往，枢纽不偏倚，<br>动静分虚实，阴阳水火济，精神宜内敛，练神得还虚，<br>头打脚随走，站他中央地，任有万能手，总也难逃避，<br>路线踏（蹈）中心，松紧不滑滞，旋转要稳准，钩错互相宜，<br>力纯智和愚，审慎对方力，随曲忽就伸，相互虚实移，<br>运劲如弓满，着敌似电急，鹰胆虎威视，足腕似兜泥，<br>鹘落似龙潜，浑身尽争力，面善心要狠，胆大更须细，<br>缠劈攒（躜）裹横，扭拧弹簧力，接触揣时机，叱咤如雷似，<br>变化影无形，周旋意无意，披纵侧方入，闪转无全空，<br>担化对方力，搓摩试其劲，歉含力蓄使，粘粘（沾）不离宗，<br>随进随退走，拘意莫放松，拿闭敌血脉，扳挽顺势封，<br>轻非用拙软，掤肩要圆撑，搂进圆活力，摧坚戮敌锋，<br>掩护敌猛入，撮点致命攻，坠专牵挽势，继续勿失空，<br>挤他虚实现，摊开即成功。顺势闪拿欺，展（转）软柔化吸，<br>撤退进推托，手脚一起发，伸手看形容，身法要偏行，<br>见手分左右，避手吸进身，上下用反劲，手脚要同心，<br>劲到吸闪空，撞崩化欺冲，手到随身变，用时如闪电，<br>粘手软绵随，气在眼前追，来时机（伶）灵进，拳打要进身，<br>见势顺他劲，变步拧腰身，手眼身法步，欺到方为真，<br>掳手随身靠，捆时反劲欺，进步耳如风，沉气在腹中，<br>若见长手法，揩（指）掳闪进崩，若见短手法，长劲沉气中，<br>若见乱手法，偏砸顺身攻，动手先看肩，堵手在胸前，<br>肩偏手必到，身仰脚必发，伸手步先行，见劲顺手中，<br>若见力（若力太）过猛，撒化闪进空，进步捋崩挤，掳发顺劲倚，<br>手眼身法步，随时变（身）体形，出手要平身，开门手为真，<br>若见高手法，撞倚先拔根，掤架打中线，掳推撞进身，<br>若见冲天手，变掌掳崩穿，若见矮手法，抽腰走上身，<br>法本耳目思，掌本面目排，手到撒化变，欺步看路线，<br>撞进里外手，反拿随身转，拐掳揩（指）闪欺，见手反拿腕，<br>欺步撞崩势，动手气下转，进身本气根，拿破随手变，<br>听问粘沾连（随），进步柔化推，上下要相随，内外要合一，<br>试声山谷应，神气要贯足，恭慎意且合，五字要言记，<br>见性明理后，反向身外去，莫教死方滞，莫教招法拘，<br>句句是要言，莫当是儿戏，愿我同道者，切记要切记。</p>
<h2 id="拳经总歌"><a href="#拳经总歌" class="headerlink" title="拳经总歌"></a>拳经总歌</h2><p>《拳经总歌》初见于河南温县陈家沟陈氏两仪堂古拳谱，属太极拳的原始理论<br>纵放屈伸人莫知，诸靠缠绕我皆依。<br>劈打推压得进步，搬撂横采也难敌。<br>钩棚逼揽人人晓，闪惊取巧有谁知？<br>佯输诈走谁云败，引诱回冲致胜归。<br>滚拴搭扫灵微妙，横直劈砍奇更奇。<br>截进遮拦穿心肘，迎风接步红包捶；<br>二换扫压挂面脚，左右边簪庄跟腿；<br>截前压后无缝锁，声东击西要熟识；<br>上笼下提君须记，进攻退闪莫迟迟。<br>藏头盖面天下有，攒心剁肋世间稀。<br>教师不识此中理，难将武艺论高低。</p>
<h2 id="清代陈长兴太极拳论：《用武要言》"><a href="#清代陈长兴太极拳论：《用武要言》" class="headerlink" title="清代陈长兴太极拳论：《用武要言》"></a>清代陈长兴太极拳论：《用武要言》</h2><pre><code>要诀云：捶自心出，拳随意发。总要知己知彼，随机应变。
</code></pre><p>　　心气一发，四肢皆动。足起有地，动转有位。或粘而游，或连而随；或腾而闪，或折而空；或掤而捋，或挤而捺。<br>　　拳打五尺以内，三尺以外；远不发肘，近不发手。无论前后左右，一步一捶。遇敌以得人为准，以不见形为妙!<br>　　拳术如战术：击其无备，袭其不意；乘击而袭，乘袭而击。虚而实之，实而虚之；避实击虚，取本求末。出遇众围，如生龙活虎之状；逢击单敌，似巨炮直轰之势。<br>　　上、中、下一气把定，身、手、足规矩绳束。手不向空起，亦不向空落，精敏神巧全在活。<br>　　古人云：能去能就，能刚能柔，能进能退。不动如山岳，难知如阴阳；无穷如天地，充实如太仓；浩渺如四海，眩曜如三光。察来势之机会，揣敌人之短长。静以待动，动以处静，然后可言拳术也!<br>　　要诀云：借法容易上法难，还是上法最为先。<br>　　战斗篇云：击手勇猛，不当击梢，迎面取中堂；抢上抢下势如虎，类似鹰鹞下鸡场。翻江泼海不须忙，丹凤朝阳最为强；云背日月天交地，武艺相争见短长。<br>　　要诀云：发步进入须进身，身手齐到是为真。法中有诀从何取?解开其理妙如神。<br>　　古有闪、进、打、顾之法：何为闪?何为进?进即闪，闪即进，不必远求!何为打?何为顾?顾即打，打即顾，发手便是!<br>　　古人云：心如火药手如弹，灵机一动鸟难逃。身似弓弦手似箭，弦响鸟落显神奇。<br>　　起手如闪电，电闪不及合眸(móu)；击敌如迅雷，雷发不及掩耳。<br>　　左过右来，右过左来。手从心内发，落向前面落。力从足上起，足起犹火作。<br>　　上左须进右，上右须进左。发步时，足跟先着地,十趾要抓地。步要稳当，身要庄重。去时撒手，著人成拳。上下气要均停，出入以身为主宰；不贪不歉，不即不离。拳由心发，以身摧手，一肢动百骸皆随。一屈统身皆屈，一伸统身皆伸；伸要伸得尽，屈要屈得紧。如卷炮卷得紧，崩得有力。<br>　　战斗篇云：不拘提打、按打，击打、冲打，膊打、肘打，胯打、腿打，头打、手打，高打、低打，顺打、横打，进步打、退步打，截气打、借气打，以及上下百般打法，总要一气相贯。<br>    “出身先占巧地”，是为战斗要诀。骨节要对，不对则无力；手把要灵，不灵则生变。发手要快，不快则迟误；打手要狠，不狠则不济。脚手要活，不活则担险；存心要精，不精则受愚。<br>　　发身要鹰扬猛勇，泼辣胆大，机智连环，勿畏惧迟疑。如关临白马，赵临长坂。神威凛凛，波开浪裂。静如山岳，动如雷发。<br>　　要诀云：人之来势，务要审察。足踢头前，拳打膊(bó)下。侧身进步，伏身起发。足来提膝，拳来肘拨。顺来横击，横来捧压；左来右接，右来左迎。远便上手，近便用肘；远便足踢，近便加膝。<br>　　拳打上风，审顾地形。手要急、足要轻，察势如猫行。心要整、目要清，身手齐到始为真。手到身不到，击敌不得妙；手到身亦到，破敌如摧草。<br>　　战斗篇云：善击者，先看步位，后下手势。上打咽喉下打阴，左右两肋并中心。前打一丈不为远，近打祗在一寸间。<br>　　要诀云：操演时，面前如有人；对敌时，有人如无人。面前手来不见手，胸前肘来不见肘。手起足要落，足落手要起。<br>　　心要占先，意要胜人。身要攻人，步要过人。头须仰起，胸须现起。腰须竖起，丹田须运起。自顶至足，一气相贯。<br>　　战斗篇云：胆战心寒者，必不能取胜；不察形势者，必不能防人。<br>　　先动为师，后动为弟。能教一思进，莫教一思退，胆欲大而心欲小。“运用之妙，存乎一心”而已!一理运乎二气，行乎三节，现乎四梢，统乎五行。时时操演，朝朝运化；始而勉强，久而自然!拳术之道学，终于此而已矣!</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[JavaScript 问题集锦]]></title>
      <url>https://lian1925.github.io/2016/09/01/js-record/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/football.jpg" alt="alt"><br>javascript 是一门非常有趣的语言，掌握它，你可以与前端开发非常愉快地玩耍。<br><a id="more"></a></p>
<h2 id="获取url附带的parameters参数值"><a href="#获取url附带的parameters参数值" class="headerlink" title="获取url附带的parameters参数值"></a>获取url附带的parameters参数值</h2><p>微信公众号支付功能实现中，遇到一个需求：如果用户同意授权，页面将跳转至 redirect_uri/?code=CODE&amp;state=STATE，我们需要获取url中的code值。<br>这部分工作，我们将在javascript文件中处理。</p>
<p>首先，JavaScript本身是不提供原生的字符串参数提取，仅仅提供了<strong>location.search</strong>，用于获取url中?后面的字符串。</p>
<p>接下来，我们可以通过正则表达式完成参数值的提取。<br>参考代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> QueryString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// This function is anonymous, is executed immediately and</span></div><div class="line">  <span class="comment">// the return value is assigned to QueryString!</span></div><div class="line">  <span class="keyword">var</span> query_string = &#123;&#125;;</div><div class="line">  <span class="keyword">var</span> query = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</div><div class="line">  <span class="keyword">var</span> vars = query.split(<span class="string">"&amp;"</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.length;i++) &#123;</div><div class="line">    <span class="keyword">var</span> pair = vars[i].split(<span class="string">"="</span>);</div><div class="line">        <span class="comment">// If first entry with this name</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"undefined"</span>) &#123;</div><div class="line">      query_string[pair[<span class="number">0</span>]] = <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]);</div><div class="line">        <span class="comment">// If second entry with this name</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"string"</span>) &#123;</div><div class="line">      <span class="keyword">var</span> arr = [ query_string[pair[<span class="number">0</span>]],<span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]) ];</div><div class="line">      query_string[pair[<span class="number">0</span>]] = arr;</div><div class="line">        <span class="comment">// If third or later entry with this name</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      query_string[pair[<span class="number">0</span>]].push(<span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> query_string;</div><div class="line">&#125;();</div><div class="line"><span class="comment">// we can get the value of code by</span></div><div class="line"><span class="keyword">var</span> value = QueryString.code;</div></pre></td></tr></table></figure></p>
<h2 id="网页重定向"><a href="#网页重定向" class="headerlink" title="网页重定向"></a>网页重定向</h2><p>我们有时希望可以在JavaScript代码中，直接跳转到我们想要的url<br>JavaScript提供了一个location对象，可以实现页面跳转<br>代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">location.href=<span class="string">"http://www.baidu.com"</span>;</div></pre></td></tr></table></figure></p>
<h2 id="cookie-基本使用"><a href="#cookie-基本使用" class="headerlink" title="cookie 基本使用"></a>cookie 基本使用</h2><p>cookie的基本功能是帮助用户在浏览器存储与读取数据。</p>
<ul>
<li><p>存储数据，假设将{name:’lian’}存于cookie;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">"lian"</span>;</div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"name="</span>+name;</div></pre></td></tr></table></figure>
</li>
<li><p>读取数据，假设要求读取上一步的name值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>)</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">var</span> arr,reg=<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^| )"</span>+name+<span class="string">"=([^;]*)(;|$)"</span>);</div><div class="line">  <span class="keyword">if</span>(arr=<span class="built_in">document</span>.cookie.match(reg))</div><div class="line">    <span class="keyword">return</span> <span class="built_in">unescape</span>(arr[<span class="number">2</span>]);</div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> name = getCookie(<span class="string">'name'</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>默认情况，cookie 将在浏览器关闭时，自动清除。其实，我们可以通过expires设置cookie的有效期。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name,value</span>)</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">var</span> Days = <span class="number">7</span>;</div><div class="line">  <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">  exp.setTime(exp.getTime() + <span class="number">10</span>*<span class="number">1000</span>);</div><div class="line">  <span class="built_in">document</span>.cookie = name + <span class="string">"="</span>+ <span class="built_in">escape</span> (value) + <span class="string">";expires="</span> + exp.toGMTString();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[跨境之微信公众号支付（wechat_publicpay）]]></title>
      <url>https://lian1925.github.io/2016/08/31/wechat-publicpay/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/yourdata.jpg" alt="alt"><br>由工作要求，需要为用户开发在微信环境下的支付功能，此处需要用到的接口为微信公众号支付接口。<br><a id="more"></a><br>又因为我们是跨境电商系统，故每笔交易支付完成，需要支付企业向海关提交支付单，此处我们用到了易极付企业提供的整合版支付接口。<br>支付流程：</p>
<ul>
<li>在微信环境下，获取支付用户的openId</li>
<li>准备交易数据：外部订单号、卖家ID、交易金额、用户的openId、用户ip</li>
<li>配合商家的基础数据，进行数据构造与签名</li>
<li>以form表单形式，向网关提交请求</li>
</ul>
<h2 id="获取用户IP"><a href="#获取用户IP" class="headerlink" title="获取用户IP"></a>获取用户IP</h2><p>对于网络协议而言，用户发送请求的数据中包含了用户所在的IP地址（起始地址）。唯有这样，服务端接收到请求，方能知道将请求结果发送至何方。<br>这里推荐一种简单的获取方法：<br><strong>ip.html</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://pv.sohu.com/cityjson?ie=utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="built_in">document</span>.write(returnCitySN[<span class="string">"cip"</span>] + <span class="string">','</span> + returnCitySN[<span class="string">"cname"</span>])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="获取用户的openId"><a href="#获取用户的openId" class="headerlink" title="获取用户的openId"></a>获取用户的openId</h2><p>用户的openId是微信用户对于公众号平台的唯一标识。<br>关于微信网页授权<br>如果用户在信息客户端访问第三方网页，公众号可以通过微信网页授权机制，以此获取用户基本信息，进而实现业务逻辑。</p>
<p>第一步，开发者需要先到公众平台官网中的开发者中心页配置授权回调域名。请注意，这里填写的是域名（是一个字符串）</p>
<p>网页授权分为两种类型:<br>1、以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）<br>2、以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。<br>此处，我们选用了第一种，snsapi_base</p>
<p>第二步，获取code值<br>引导关注者打开如下页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</div></pre></td></tr></table></figure></p>
<p>如果用户同意授权，页面将跳转至 redirect_uri/?code=CODE&amp;state=STATE，我们需要获取url中的code值。</p>
<p>第三步，获取openId<br>用http的get请求，如下url，即可获取openId值<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</div></pre></td></tr></table></figure></p>
<p>第四步，构造请求参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commonWchatPublicPay</span><span class="params">()</span> </span>&#123;</div><div class="line">	data.put(<span class="string">"partnerId"</span>, <span class="string">""</span>); <span class="comment">// 商户id</span></div><div class="line">	data.put(<span class="string">"signType"</span>, <span class="string">"MD5"</span>);</div><div class="line">	data.put(<span class="string">"returnUrl"</span>, <span class="string">""</span>); <span class="comment">// 支付完成后返回url</span></div><div class="line">	data.put(<span class="string">"notifyUrl"</span>, <span class="string">""</span>);<span class="comment">// 异步回执，提供结果通知</span></div><div class="line">	data.put(<span class="string">"protocol"</span>, <span class="string">"httpPost"</span>);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">// 用时分秒生成一个20-40位的orderNo，推荐8位日期+8-12位业务序号</span></div><div class="line">	SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssssSSSS"</span>);</div><div class="line">	String orderNo = df.format(<span class="keyword">new</span> Date());</div><div class="line">	data.put(<span class="string">"orderNo"</span>, orderNo); <span class="comment">// 订单号处理方式同微信支付</span></div><div class="line"></div><div class="line">	data.put(<span class="string">"outOrderNo"</span>, orderNo); <span class="comment">// 此处外部订单号，从数据库获取</span></div><div class="line">	data.put(<span class="string">"service"</span>, <span class="string">"commonWchatPublicPay"</span>);</div><div class="line">	data.put(<span class="string">"sellerUserId"</span>, <span class="string">""</span>); <span class="comment">// 商户id</span></div><div class="line"></div><div class="line">	data.put(<span class="string">"tradeAmount"</span>, <span class="string">""</span>);<span class="comment">// 交易金额，如：100.00</span></div><div class="line">	data.put(<span class="string">"userEndIp"</span>, <span class="string">""</span>);<span class="comment">// 用户ip，取第一步获取的值</span></div><div class="line">	data.put(<span class="string">"openid"</span>, <span class="string">""</span>); <span class="comment">// 取第三步获取的值</span></div><div class="line">	data.put(<span class="string">"goodsClauses"</span>, <span class="string">"[&#123;\"name\":\"母婴商品\"&#125;]"</span>);</div><div class="line"></div><div class="line">	String signString = signString(data, <span class="string">""</span>);<span class="comment">// 补充密钥，完成签名</span></div><div class="line"></div><div class="line">	String sign = MD5.MD5(signString);</div><div class="line">	data.put(<span class="string">"sign"</span>, sign);</div><div class="line">	String result = Http.postString(data, <span class="string">"https://api.yiji.com/gateway.html"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="附js部分代码"><a href="#附js部分代码" class="headerlink" title="附js部分代码"></a>附js部分代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://pv.sohu.com/cityjson?ie=utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="built_in">document</span>.write(returnCitySN[<span class="string">"cip"</span>] + <span class="string">','</span> + returnCitySN[<span class="string">"cname"</span>])</div><div class="line">			<span class="keyword">var</span> QueryString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="comment">// This function is anonymous, is executed immediately and</span></div><div class="line">				<span class="comment">// the return value is assigned to QueryString!</span></div><div class="line">				<span class="keyword">var</span> query_string = &#123;&#125;;</div><div class="line">				<span class="keyword">var</span> query = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</div><div class="line">				<span class="keyword">var</span> vars = query.split(<span class="string">"&amp;"</span>);</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; vars.length; i++) &#123;</div><div class="line">					<span class="keyword">var</span> pair = vars[i].split(<span class="string">"="</span>);</div><div class="line">					<span class="comment">// If first entry with this name</span></div><div class="line">					<span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"undefined"</span>) &#123;</div><div class="line">						query_string[pair[<span class="number">0</span>]] = <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]);</div><div class="line">						<span class="comment">// If second entry with this name</span></div><div class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"string"</span>) &#123;</div><div class="line">						<span class="keyword">var</span> arr = [query_string[pair[<span class="number">0</span>]], <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>])];</div><div class="line">						query_string[pair[<span class="number">0</span>]] = arr;</div><div class="line">						<span class="comment">// If third or later entry with this name</span></div><div class="line">					&#125; <span class="keyword">else</span> &#123;</div><div class="line">						query_string[pair[<span class="number">0</span>]].push(<span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]));</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">return</span> query_string;</div><div class="line">			&#125;();</div><div class="line">			$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> param = &#123;</div><div class="line">					openid: <span class="string">''</span>,</div><div class="line">					appid: <span class="string">'wx07e728dc89fbe40c'</span>,</div><div class="line">					redirect_uri: <span class="string">'http://www.360hai.cn/publicpay'</span>,</div><div class="line">					response_type: <span class="string">'code'</span>,</div><div class="line">					scope: <span class="string">'snsapi_base'</span>,</div><div class="line">					state: <span class="string">'223'</span>,</div><div class="line">					secret: <span class="string">'e3f586735b1785b38e1ec6cd718b0e6a'</span>,</div><div class="line">					grant_type: <span class="string">'authorization_code'</span>,</div><div class="line">					access_token_url: <span class="string">'https://api.weixin.qq.com/sns/oauth2/access_token?'</span>,</div><div class="line">					code_url: <span class="string">'https://open.weixin.qq.com/connect/oauth2/authorize?'</span></div><div class="line">				&#125;</div><div class="line">				param.code_url += <span class="string">'appid='</span> + param.appid;</div><div class="line">				param.code_url += <span class="string">'&amp;redirect_uri='</span> + param.redirect_uri;</div><div class="line">				param.code_url += <span class="string">'&amp;response_type='</span> + param.response_type;</div><div class="line">				param.code_url += <span class="string">'&amp;scope='</span> + param.scope;</div><div class="line">				param.code_url += <span class="string">'&amp;state='</span> + param.state;</div><div class="line">				param.code_url += <span class="string">'#wechat_redirect'</span>;</div><div class="line">				<span class="keyword">var</span> code = QueryString.code;</div><div class="line">				<span class="keyword">var</span> state = QueryString.state;</div><div class="line">				<span class="keyword">if</span> (state !== param.state) &#123;</div><div class="line"><span class="comment">//					alert('lian')</span></div><div class="line">					location.href = param.code_url;</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					param.access_token_url += <span class="string">'appid='</span> + param.appid;</div><div class="line">					param.access_token_url += <span class="string">'&amp;secret='</span> + param.secret;</div><div class="line">					param.access_token_url += <span class="string">'&amp;code='</span> + code;</div><div class="line">					param.access_token_url += <span class="string">'&amp;grant_type='</span> + param.grant_type;</div><div class="line">					<span class="comment">// 获取openid</span></div><div class="line">					$.get(param.access_token_url, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">						param.openid = data.openid;</div><div class="line">					&#125;)</div><div class="line">				&#125;</div><div class="line">			&#125;);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[博客档案]]></title>
      <url>https://lian1925.github.io/2016/08/30/hexo-record/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/communicat.jpg" alt="alt"><br>此文档用于记录hexo 使用过程中遇到的一些问题及解决思考，或可供后来者参考。<br><a id="more"></a></p>
<h2 id="快速发布博客"><a href="#快速发布博客" class="headerlink" title="快速发布博客"></a>快速发布博客</h2><p>欲只需一句命令，将blog内容，发布于github服务器。<br>配置 站点配置文件<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">deploy:</span></div><div class="line"><span class="attr">  type:</span> git</div><div class="line"><span class="attr">  repo:</span> https://github.com/lian1925/lian1925.github.io.git</div><div class="line"><span class="attr">  branch:</span> master</div></pre></td></tr></table></figure></p>
<p>执行 hexo deploy<br>出现错误提示：<br>error deployer not found:git</p>
<p>原因分析：<br>hexo-deployer-git plugin过期</p>
<p>解决方案：<br>重新安装该plugin即可<br>npm install hexo-deployer-git –save</p>
<h2 id="添加评论功能"><a href="#添加评论功能" class="headerlink" title="添加评论功能"></a>添加评论功能</h2><p>登录 <em>多说</em> 官网</p>
<ul>
<li>登录后，选择 <em>我要安装</em></li>
<li>填写信息，多说域名代表 duoshuo_shortname</li>
<li>在站点配置文件中，新增 duoshuo_shortname 字段，如下：<br>duoshuo_shortname: lian1925</li>
<li>That’s all</li>
</ul>
<h2 id="添加阅读量-不蒜"><a href="#添加阅读量-不蒜" class="headerlink" title="添加阅读量 不蒜"></a>添加阅读量 不蒜</h2><p>静态网站技术，意味着大部分的内容都是事先编辑好，保存为静态（不经常变动意思）。故，一些动态的内容，如评论、计数等模块就需要借助外来平台。<br>计数有“不蒜”，号称一行脚本+一行标签，搞定一切</p>
<ul>
<li><p>在网页中，加入busuanzi.js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_pv"</span>&gt;</span>本站总访问量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_pv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="添加站内博客搜索"><a href="#添加站内博客搜索" class="headerlink" title="添加站内博客搜索"></a>添加站内博客搜索</h2><p>添加local search</p>
<ul>
<li><p>安装hexo-generator-search</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-generator-search --save</div></pre></td></tr></table></figure>
</li>
<li><p>编辑站点配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">search:</span></div><div class="line"><span class="attr">  path:</span> search.xml</div><div class="line"><span class="attr">  field:</span> post</div></pre></td></tr></table></figure>
</li>
</ul>
<p>但是，遇到一个小问题：搜索关键字，点击结果列表，发现指引到了错误的页面，如：<a href="http://144.dragonparking.com/?site=yoursite.com&amp;t=1472696460&amp;s=bd69f3d2c55abb3dcf520e33640fb857" target="_blank" rel="external">http://144.dragonparking.com/?site=yoursite.com&amp;t=1472696460&amp;s=bd69f3d2c55abb3dcf520e33640fb857</a></p>
<p>分析：site=yoursite.com 给了我一个非常重要的情报。猜测，当前系统将site指引到了yoursite.com，而不是我们网站的真正url。<br>故，因此在站点配置文件中修改：<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># URL</span></div><div class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></div><div class="line"><span class="attr">url:</span> https://lian1925.github.io/</div></pre></td></tr></table></figure></p>
<p>果然，问题解决。</p>
]]></content>
    </entry>
    
  
  
</search>
