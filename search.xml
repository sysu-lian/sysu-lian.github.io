<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[JavaScript 问题集锦]]></title>
      <url>https://lian1925.github.io/2016/09/01/js-record/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/football.jpg" alt="alt"><br>javascript 是一门非常有趣的语言，掌握它，你可以与前端开发非常愉快地玩耍。<br><a id="more"></a></p>
<h2 id="获取url附带的parameters参数值"><a href="#获取url附带的parameters参数值" class="headerlink" title="获取url附带的parameters参数值"></a>获取url附带的parameters参数值</h2><p>微信公众号支付功能实现中，遇到一个需求：如果用户同意授权，页面将跳转至 redirect_uri/?code=CODE&amp;state=STATE，我们需要获取url中的code值。<br>这部分工作，我们将在javascript文件中处理。</p>
<p>首先，JavaScript本身是不提供原生的字符串参数提取，仅仅提供了<strong>location.search</strong>，用于获取url中?后面的字符串。</p>
<p>接下来，我们可以通过正则表达式完成参数值的提取。<br>参考代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> QueryString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// This function is anonymous, is executed immediately and</span></div><div class="line">  <span class="comment">// the return value is assigned to QueryString!</span></div><div class="line">  <span class="keyword">var</span> query_string = &#123;&#125;;</div><div class="line">  <span class="keyword">var</span> query = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</div><div class="line">  <span class="keyword">var</span> vars = query.split(<span class="string">"&amp;"</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.length;i++) &#123;</div><div class="line">    <span class="keyword">var</span> pair = vars[i].split(<span class="string">"="</span>);</div><div class="line">        <span class="comment">// If first entry with this name</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"undefined"</span>) &#123;</div><div class="line">      query_string[pair[<span class="number">0</span>]] = <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]);</div><div class="line">        <span class="comment">// If second entry with this name</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> query_string[pair[<span class="number">0</span>]] === <span class="string">"string"</span>) &#123;</div><div class="line">      <span class="keyword">var</span> arr = [ query_string[pair[<span class="number">0</span>]],<span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]) ];</div><div class="line">      query_string[pair[<span class="number">0</span>]] = arr;</div><div class="line">        <span class="comment">// If third or later entry with this name</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      query_string[pair[<span class="number">0</span>]].push(<span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> query_string;</div><div class="line">&#125;();</div><div class="line"><span class="comment">// we can get the value of code by</span></div><div class="line"><span class="keyword">var</span> value = QueryString.code;</div></pre></td></tr></table></figure></p>
<h2 id="网页重定向"><a href="#网页重定向" class="headerlink" title="网页重定向"></a>网页重定向</h2><p>我们有时希望可以在JavaScript代码中，直接跳转到我们想要的url<br>JavaScript提供了一个location对象，可以实现页面跳转<br>代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">location.href=<span class="string">"http://www.baidu.com"</span>;</div></pre></td></tr></table></figure></p>
<h2 id="cookie-基本使用"><a href="#cookie-基本使用" class="headerlink" title="cookie 基本使用"></a>cookie 基本使用</h2><p>cookie的基本功能是帮助用户在浏览器存储与读取数据。</p>
<ul>
<li><p>存储数据，假设将{name:’lian’}存于cookie;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">"lian"</span>;</div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"name="</span>+name;</div></pre></td></tr></table></figure>
</li>
<li><p>读取数据，假设要求读取上一步的name值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>)</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">var</span> arr,reg=<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^| )"</span>+name+<span class="string">"=([^;]*)(;|$)"</span>);</div><div class="line">  <span class="keyword">if</span>(arr=<span class="built_in">document</span>.cookie.match(reg))</div><div class="line">    <span class="keyword">return</span> <span class="built_in">unescape</span>(arr[<span class="number">2</span>]);</div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> name = getCookie(<span class="string">'name'</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>默认情况，cookie 将在浏览器关闭时，自动清除。其实，我们可以通过expires设置cookie的有效期。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name,value</span>)</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">var</span> Days = <span class="number">7</span>;</div><div class="line">  <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">  exp.setTime(exp.getTime() + <span class="number">10</span>*<span class="number">1000</span>);</div><div class="line">  <span class="built_in">document</span>.cookie = name + <span class="string">"="</span>+ <span class="built_in">escape</span> (value) + <span class="string">";expires="</span> + exp.toGMTString();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[跨境之微信公众号支付（wechat_publicpay）]]></title>
      <url>https://lian1925.github.io/2016/08/31/wechat-publicpay/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/yourdata.jpg" alt="alt"><br>由工作要求，需要为用户开发在微信环境下的支付功能，此处需要用到的接口为微信公众号支付接口。<br>又因为我们是跨境电商系统，故每笔交易支付完成，需要支付企业向海关提交支付单，此处我们用到了易极付企业提供的整合版支付接口。<br><a id="more"></a><br>支付流程：</p>
<ul>
<li>在微信环境下，获取支付用户的openId</li>
<li>准备交易数据：外部订单号、卖家ID、交易金额、用户的openId、用户ip</li>
<li>配合商家的基础数据，进行数据构造与签名</li>
<li>以form表单形式，向网关提交请求</li>
</ul>
<h2 id="获取用户IP"><a href="#获取用户IP" class="headerlink" title="获取用户IP"></a>获取用户IP</h2><p>对于网络协议而言，用户发送请求的数据中包含了用户所在的IP地址（起始地址）。唯有这样，服务端接收到请求，方能知道将请求结果发送至何方。<br>这里推荐一种简单的获取方法：<br><strong>ip.html</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://pv.sohu.com/cityjson?ie=utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">			document.write(returnCitySN["cip"] + ',' + returnCitySN["cname"])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="获取用户的openId"><a href="#获取用户的openId" class="headerlink" title="获取用户的openId"></a>获取用户的openId</h2><p>用户的openId是微信用户对于公众号平台的唯一标识。<br>关于微信网页授权<br>如果用户在信息客户端访问第三方网页，公众号可以通过微信网页授权机制，以此获取用户基本信息，进而实现业务逻辑。</p>
<p>第一步，开发者需要先到公众平台官网中的开发者中心页配置授权回调域名。请注意，这里填写的是域名（是一个字符串）</p>
<p>网页授权分为两种类型:<br>1、以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）<br>2、以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。<br>此处，我们选用了第一种，snsapi_base</p>
<p>第二步，获取code值<br>引导关注者打开如下页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</div></pre></td></tr></table></figure></p>
<p>如果用户同意授权，页面将跳转至 redirect_uri/?code=CODE&amp;state=STATE，我们需要获取url中的code值。</p>
<p>第三步，获取openId<br>用http的get请求，如下url，即可获取openId值<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</div></pre></td></tr></table></figure></p>
<p>第四步，构造请求参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commonWchatPublicPay</span><span class="params">()</span> </span>&#123;</div><div class="line">	data.put(<span class="string">"partnerId"</span>, <span class="string">""</span>); <span class="comment">// 商户id</span></div><div class="line">	data.put(<span class="string">"signType"</span>, <span class="string">"MD5"</span>);</div><div class="line">	data.put(<span class="string">"returnUrl"</span>, <span class="string">""</span>); <span class="comment">// 支付完成后返回url</span></div><div class="line">	data.put(<span class="string">"notifyUrl"</span>, <span class="string">""</span>);<span class="comment">// 异步回执，提供结果通知</span></div><div class="line">	data.put(<span class="string">"protocol"</span>, <span class="string">"httpPost"</span>);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">// 用时分秒生成一个20-40位的orderNo，推荐8位日期+8-12位业务序号</span></div><div class="line">	SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssssSSSS"</span>);</div><div class="line">	String orderNo = df.format(<span class="keyword">new</span> Date());</div><div class="line">	data.put(<span class="string">"orderNo"</span>, orderNo); <span class="comment">// 订单号处理方式同微信支付</span></div><div class="line"></div><div class="line">	data.put(<span class="string">"outOrderNo"</span>, orderNo); <span class="comment">// 此处外部订单号，从数据库获取</span></div><div class="line">	data.put(<span class="string">"service"</span>, <span class="string">"commonWchatPublicPay"</span>);</div><div class="line">	data.put(<span class="string">"sellerUserId"</span>, <span class="string">""</span>); <span class="comment">// 商户id</span></div><div class="line"></div><div class="line">	data.put(<span class="string">"tradeAmount"</span>, <span class="string">""</span>);<span class="comment">// 交易金额，如：100.00</span></div><div class="line">	data.put(<span class="string">"userEndIp"</span>, <span class="string">""</span>);<span class="comment">// 用户ip，取第一步获取的值</span></div><div class="line">	data.put(<span class="string">"openid"</span>, <span class="string">""</span>); <span class="comment">// 取第三步获取的值</span></div><div class="line">	data.put(<span class="string">"goodsClauses"</span>, <span class="string">"[&#123;\"name\":\"母婴商品\"&#125;]"</span>);</div><div class="line"></div><div class="line">	String signString = signString(data, <span class="string">""</span>);<span class="comment">// 补充密钥，完成签名</span></div><div class="line"></div><div class="line">	String sign = MD5.MD5(signString);</div><div class="line">	data.put(<span class="string">"sign"</span>, sign);</div><div class="line">	String result = Http.postString(data, <span class="string">"https://api.yiji.com/gateway.html"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="附js部分代码"><a href="#附js部分代码" class="headerlink" title="附js部分代码"></a>附js部分代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://pv.sohu.com/cityjson?ie=utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="xml"></span></div><div class="line">			document.write(returnCitySN["cip"] + ',' + returnCitySN["cname"])</div><div class="line">			var QueryString = function() &#123;</div><div class="line">				// This function is anonymous, is executed immediately and</div><div class="line">				// the return value is assigned to QueryString!</div><div class="line">				var query_string = &#123;&#125;;</div><div class="line">				var query = window.location.search.substring(1);</div><div class="line">				var vars = query.split("&amp;");</div><div class="line">				for (var i = 0; i <span class="tag">&lt; <span class="attr">vars.length</span>; <span class="attr">i</span>++) &#123;</span></div><div class="line">					<span class="attr">var</span> <span class="attr">pair</span> = <span class="string">vars[i].split(</span>"=<span class="string">");</span></div><div class="line">					// If first entry with this name</div><div class="line">					if (typeof query_string[pair[0]] === "<span class="attr">undefined</span>") &#123;</div><div class="line">						<span class="attr">query_string</span>[<span class="attr">pair</span>[<span class="attr">0</span>]] = <span class="string">decodeURIComponent(pair[1]);</span></div><div class="line">						// <span class="attr">If</span> <span class="attr">second</span> <span class="attr">entry</span> <span class="attr">with</span> <span class="attr">this</span> <span class="attr">name</span></div><div class="line">					&#125; <span class="attr">else</span> <span class="attr">if</span> (<span class="attr">typeof</span> <span class="attr">query_string</span>[<span class="attr">pair</span>[<span class="attr">0</span>]] === <span class="string">"string"</span>) &#123;</div><div class="line">						<span class="attr">var</span> <span class="attr">arr</span> = <span class="string">[query_string[pair[0]],</span> <span class="attr">decodeURIComponent</span>(<span class="attr">pair</span>[<span class="attr">1</span>])];</div><div class="line">						<span class="attr">query_string</span>[<span class="attr">pair</span>[<span class="attr">0</span>]] = <span class="string">arr;</span></div><div class="line">						// <span class="attr">If</span> <span class="attr">third</span> <span class="attr">or</span> <span class="attr">later</span> <span class="attr">entry</span> <span class="attr">with</span> <span class="attr">this</span> <span class="attr">name</span></div><div class="line">					&#125; <span class="attr">else</span> &#123;</div><div class="line">						<span class="attr">query_string</span>[<span class="attr">pair</span>[<span class="attr">0</span>]]<span class="attr">.push</span>(<span class="attr">decodeURIComponent</span>(<span class="attr">pair</span>[<span class="attr">1</span>]));</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="attr">return</span> <span class="attr">query_string</span>;</div><div class="line">			&#125;();</div><div class="line">			$(<span class="attr">document</span>)<span class="attr">.ready</span>(<span class="attr">function</span>() &#123;</div><div class="line">				<span class="attr">var</span> <span class="attr">param</span> = <span class="string">&#123;</span></div><div class="line">					<span class="attr">openid:</span> '',</div><div class="line">					<span class="attr">appid:</span> '<span class="attr">wx07e728dc89fbe40c</span>',</div><div class="line">					<span class="attr">redirect_uri:</span> '<span class="attr">http:</span>//<span class="attr">www.360hai.cn</span>/<span class="attr">publicpay</span>',</div><div class="line">					<span class="attr">response_type:</span> '<span class="attr">code</span>',</div><div class="line">					<span class="attr">scope:</span> '<span class="attr">snsapi_base</span>',</div><div class="line">					<span class="attr">state:</span> '<span class="attr">223</span>',</div><div class="line">					<span class="attr">secret:</span> '<span class="attr">e3f586735b1785b38e1ec6cd718b0e6a</span>',</div><div class="line">					<span class="attr">grant_type:</span> '<span class="attr">authorization_code</span>',</div><div class="line">					<span class="attr">access_token_url:</span> '<span class="attr">https:</span>//<span class="attr">api.weixin.qq.com</span>/<span class="attr">sns</span>/<span class="attr">oauth2</span>/<span class="attr">access_token</span>?',</div><div class="line">					<span class="attr">code_url:</span> '<span class="attr">https:</span>//<span class="attr">open.weixin.qq.com</span>/<span class="attr">connect</span>/<span class="attr">oauth2</span>/<span class="attr">authorize</span>?'</div><div class="line">				&#125;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'appid='</span> + <span class="attr">param.appid</span>;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'&amp;redirect_uri='</span> + <span class="attr">param.redirect_uri</span>;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'&amp;response_type='</span> + <span class="attr">param.response_type</span>;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'&amp;scope='</span> + <span class="attr">param.scope</span>;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'&amp;state='</span> + <span class="attr">param.state</span>;</div><div class="line">				<span class="attr">param.code_url</span> += <span class="string">'#wechat_redirect'</span>;</div><div class="line">				<span class="attr">var</span> <span class="attr">code</span> = <span class="string">QueryString.code;</span></div><div class="line">				<span class="attr">var</span> <span class="attr">state</span> = <span class="string">QueryString.state;</span></div><div class="line">				<span class="attr">if</span> (<span class="attr">state</span> !== <span class="string">param.state)</span> &#123;</div><div class="line">//					<span class="attr">alert</span>('<span class="attr">lian</span>')</div><div class="line">					<span class="attr">location.href</span> = <span class="string">param.code_url;</span></div><div class="line">				&#125; <span class="attr">else</span> &#123;</div><div class="line">					<span class="attr">param.access_token_url</span> += <span class="string">'appid='</span> + <span class="attr">param.appid</span>;</div><div class="line">					<span class="attr">param.access_token_url</span> += <span class="string">'&amp;secret='</span> + <span class="attr">param.secret</span>;</div><div class="line">					<span class="attr">param.access_token_url</span> += <span class="string">'&amp;code='</span> + <span class="attr">code</span>;</div><div class="line">					<span class="attr">param.access_token_url</span> += <span class="string">'&amp;grant_type='</span> + <span class="attr">param.grant_type</span>;</div><div class="line">					// 获取<span class="attr">openid</span></div><div class="line">					$<span class="attr">.get</span>(<span class="attr">param.access_token_url</span>, <span class="attr">function</span>(<span class="attr">data</span>) &#123;</div><div class="line">						<span class="attr">param.openid</span> = <span class="string">data.openid;</span></div><div class="line">					&#125;)</div><div class="line">				&#125;</div><div class="line">			&#125;);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[博客档案]]></title>
      <url>https://lian1925.github.io/2016/08/30/hexo-record/</url>
      <content type="html"><![CDATA[<p><img src="/uploads/communicat.jpg" alt="alt"><br>此文档用于记录hexo 使用过程中遇到的一些问题及解决思考，或可供后来者参考。<br><a id="more"></a></p>
<h2 id="快速发布博客"><a href="#快速发布博客" class="headerlink" title="快速发布博客"></a>快速发布博客</h2><p>欲只需一句命令，将blog内容，发布于github服务器。<br>配置 站点配置文件<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">deploy:</span></div><div class="line"><span class="attr">  type:</span> git</div><div class="line"><span class="attr">  repo:</span> https://github.com/lian1925/lian1925.github.io.git</div><div class="line"><span class="attr">  branch:</span> master</div></pre></td></tr></table></figure></p>
<p>执行 hexo deploy<br>出现错误提示：<br>error deployer not found:git</p>
<p>原因分析：<br>hexo-deployer-git plugin过期</p>
<p>解决方案：<br>重新安装该plugin即可<br>npm install hexo-deployer-git –save</p>
<h2 id="添加评论功能"><a href="#添加评论功能" class="headerlink" title="添加评论功能"></a>添加评论功能</h2><p>登录 <em>多说</em> 官网</p>
<ul>
<li>登录后，选择 <em>我要安装</em></li>
<li>填写信息，多说域名代表 duoshuo_shortname</li>
<li>在站点配置文件中，新增 duoshuo_shortname 字段，如下：<br>duoshuo_shortname: lian1925</li>
<li>That’s all</li>
</ul>
<h2 id="添加阅读量-不蒜"><a href="#添加阅读量-不蒜" class="headerlink" title="添加阅读量 不蒜"></a>添加阅读量 不蒜</h2><p>静态网站技术，意味着大部分的内容都是事先编辑好，保存为静态（不经常变动意思）。故，一些动态的内容，如评论、计数等模块就需要借助外来平台。<br>计数有“不蒜”，号称一行脚本+一行标签，搞定一切</p>
<ul>
<li><p>在网页中，加入busuanzi.js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_pv"</span>&gt;</span>本站总访问量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_pv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="添加站内博客搜索"><a href="#添加站内博客搜索" class="headerlink" title="添加站内博客搜索"></a>添加站内博客搜索</h2><p>添加local search</p>
<ul>
<li><p>安装hexo-generator-search</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-generator-search --save</div></pre></td></tr></table></figure>
</li>
<li><p>编辑站点配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">search:</span></div><div class="line"><span class="attr">  path:</span> search.xml</div><div class="line"><span class="attr">  field:</span> post</div></pre></td></tr></table></figure>
</li>
</ul>
<p>但是，遇到一个小问题：搜索关键字，点击结果列表，发现指引到了错误的页面，如：<a href="http://144.dragonparking.com/?site=yoursite.com&amp;t=1472696460&amp;s=bd69f3d2c55abb3dcf520e33640fb857" target="_blank" rel="external">http://144.dragonparking.com/?site=yoursite.com&amp;t=1472696460&amp;s=bd69f3d2c55abb3dcf520e33640fb857</a></p>
<p>分析：site=yoursite.com 给了我一个非常重要的情报。猜测，当前系统将site指引到了yoursite.com，而不是我们网站的真正url。<br>故，因此在站点配置文件中修改：<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># URL</span></div><div class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></div><div class="line"><span class="attr">url:</span> https://lian1925.github.io/</div></pre></td></tr></table></figure></p>
<p>果然，问题解决。</p>
]]></content>
    </entry>
    
  
  
</search>
